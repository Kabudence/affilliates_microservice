{% extends "dashboard/base.html" %}
{% block title %}Horarios{% endblock %}

{% block content %}
<h2 style="color:#e50914;font-weight:900;">Agregar precios y duración a: {{ plan.name }}</h2>

{% with msgs = get_flashed_messages(with_categories=true) %}
  {% if msgs %}
    {% for cat, msg in msgs %}
      <div class="alert alert-{{ cat }} alert-dismissible fade show" role="alert">
        {{ msg }} <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form method="post" class="app-feature-box" style="max-width:500px;">
  <div id="times-list">
    <div class="row mb-2">
      <div class="col-6">
        <label>Duración (meses)</label>
        <input type="number" name="duration" class="form-control" required min="1">
      </div>
      <div class="col-6">
        <label>Precio (S/)</label>
        <input type="number" step="0.01" name="price" class="form-control" required min="0">
      </div>
    </div>
  </div>
  <button type="button" class="btn btn-secondary mb-3" onclick="addRow()">Agregar otra duración</button>
  <button type="submit" class="btn btn-app w-100">Guardar horarios</button>
  <a href="{{ url_for('rental_module_api.planes_index') }}" class="btn btn-secondary w-100 mt-2">Cancelar</a>
</form>

{% if plan_times %}
<div class="mt-4">
  <h5>Horarios existentes:</h5>
  <ul class="list-group">
    {% for t in plan_times %}
      <li class="list-group-item list-group-item-dark d-flex justify-content-between align-items-center">
        {{ t.duration }} m – S/ {{ '%.2f'|format(t.price) }}
        <form action="{{ url_for('rental_module_api.plan_time_delete',
                                 plan_id=plan.id, time_id=t.id) }}"
              method="POST" onsubmit="return confirm('¿Eliminar horario?');">
          <button class="btn btn-sm btn-danger">&times;</button>
        </form>
      </li>
    {% endfor %}
  </ul>
</div>
{% endif %}

<script>
function addRow() {
  const html = `
    <div class="row mb-2">
      <div class="col-6">
        <input type="number" name="duration" class="form-control" required min="1"
               placeholder="Duración (meses)">
      </div>
      <div class="col-6">
        <input type="number" step="0.01" name="price" class="form-control" required min="0"
               placeholder="Precio (S/)">
      </div>
    </div>`;
  document.getElementById('times-list').insertAdjacentHTML('beforeend', html);
}
</script>
{% endblock %}
